package dev.tenacity.module.impl.exploit

import dev.tenacity.event.impl.game.KeyPressEvent
import dev.tenacity.event.impl.network.PacketReceiveEvent
import dev.tenacity.event.impl.player.MotionEvent
import dev.tenacity.event.impl.render.RenderChestEvent
import dev.tenacity.module.Category
import dev.tenacity.module.Module
import net.minecraft.client.gui.inventory.GuiContainer
import net.minecraft.client.gui.inventory.GuiInventory
import net.minecraft.network.play.client.C0DPacketCloseWindow
import net.minecraft.network.play.server.S2EPacketCloseWindow
import org.lwjgl.input.Keyboard

class KeepContainer:Module("KeepContainer",Category.EXPLOIT,"Keep your Container") {
    private var container: GuiContainer? = null


    override fun onDisable() {
        if (container != null)
            mc.netHandler.addToSendQueue(C0DPacketCloseWindow(container!!.inventorySlots.windowId));

        container = null
        super.onDisable()
    }

    override fun onPacketReceiveEvent(event: PacketReceiveEvent?) {
        if(event?.packet is C0DPacketCloseWindow)
            event.cancel()
        else if (event?.packet is S2EPacketCloseWindow) {
            if (container != null && container!!.inventorySlots != null && event.packet.id == container!!.inventorySlots!!.windowId)
                container = null
        }
    }


    override fun onKeyPressEvent(event: KeyPressEvent?) {
        if (event?.key == Keyboard.KEY_INSERT) {
            if (container == null)
                return

            mc.displayGuiScreen(container)
        }
    }

}